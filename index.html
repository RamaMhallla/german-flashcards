<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Ø¨Ø·Ø§Ù‚Ø§Øª ÙƒÙ„Ù…Ø§Øª Ø£Ù„Ù…Ø§Ù†ÙŠØ© (Deutschâ†’Arabisch)</title>
    <style>
      :root {
        --bg-primary: #f8fafc;
        --bg-secondary: #f1f5f9;
        --bg-card: #ffffff;
        --text-primary: #1e293b;
        --text-secondary: #64748b;
        --accent-primary: #3b82f6;
        --accent-secondary: #60a5fa;
        --accent-success: #10b981;
        --accent-warning: #f59e0b;
        --accent-danger: #ef4444;
        --border-light: #e2e8f0;
        --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1),
          0 2px 4px -1px rgba(0, 0, 0, 0.06);
        --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1),
          0 4px 6px -2px rgba(0, 0, 0, 0.05);
        --transition: all 0.3s ease;
      }
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
      body {
        background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
        font-family: system-ui, -apple-system, "Segoe UI", Roboto, Ubuntu,
          "Noto Sans", Tahoma, Arial;
        color: var(--text-primary);
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 20px;
        line-height: 1.6;
      }
      .app {
        width: min(1000px, 100%);
        margin: 0 auto;
      }
      header {
        display: flex;
        gap: 16px;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 24px;
        flex-wrap: wrap;
        background: var(--bg-card);
        padding: 16px 24px;
        border-radius: 20px;
        box-shadow: var(--shadow);
      }
      .title {
        font-weight: 800;
        font-size: clamp(20px, 3vw, 28px);
        color: var(--accent-primary);
        display: flex;
        align-items: center;
        gap: 12px;
      }
      .title::before {
        content: "ğŸ“š";
        font-size: 1.2em;
      }
      .controls {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        align-items: center;
      }
      button,
      .btn {
        background: var(--bg-card);
        color: var(--text-primary);
        border: 1px solid var(--border-light);
        padding: 10px 16px;
        border-radius: 12px;
        cursor: pointer;
        transition: var(--transition);
        font-weight: 500;
        display: flex;
        align-items: center;
        gap: 6px;
        box-shadow: var(--shadow);
      }
      button:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-lg);
      }
      button:active {
        transform: translateY(0);
      }
      .accent {
        background: var(--accent-primary);
        color: white;
        border: none;
      }
      .accent2 {
        background: var(--accent-secondary);
        color: white;
        border: none;
      }
      .success {
        background: var(--accent-success);
        color: white;
        border: none;
      }
      .danger {
        background: var(--accent-danger);
        color: white;
        border: none;
      }
      .warning {
        background: var(--accent-warning);
        color: white;
        border: none;
      }
      .wrap {
        display: grid;
        gap: 20px;
      }
      .stats {
        display: flex;
        gap: 16px;
        align-items: center;
        flex-wrap: wrap;
        font-size: 15px;
        color: var(--text-secondary);
        background: var(--bg-card);
        padding: 16px 24px;
        border-radius: 16px;
        box-shadow: var(--shadow);
      }
      .progress {
        height: 10px;
        background: var(--bg-secondary);
        border-radius: 999px;
        overflow: hidden;
        width: 240px;
        flex-shrink: 0;
      }
      .progress > i {
        display: block;
        height: 100%;
        background: linear-gradient(
          90deg,
          var(--accent-primary),
          var(--accent-secondary)
        );
        width: 0%;
        border-radius: 999px;
        transition: width 0.5s ease;
      }
      .scene {
        perspective: 1200px;
        margin: 16px auto;
      }
      .card {
        position: relative;
        width: min(700px, 96vw);
        height: 360px;
        margin-inline: auto;
        transform-style: preserve-3d;
        transition: transform 0.6s ease;
        cursor: pointer;
      }
      .card.flipped {
        transform: rotateY(180deg);
      }
      .face {
        position: absolute;
        inset: 0;
        background: var(--bg-card);
        border-radius: 24px;
        backface-visibility: hidden;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 32px;
        text-align: center;
        box-shadow: var(--shadow-lg);
        border: 1px solid var(--border-light);
        overflow: hidden;
      }
      .face::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 6px;
        background: linear-gradient(
          90deg,
          var(--accent-primary),
          var(--accent-secondary)
        );
      }
      .back {
        transform: rotateY(180deg);
      }
      .word {
        font-size: clamp(28px, 5vw, 44px);
        font-weight: 800;
        letter-spacing: 0.4px;
        margin-bottom: 12px;
        color: var(--text-primary);
      }
      .sub {
        font-size: clamp(14px, 2vw, 16px);
        color: var(--text-secondary);
        display: flex;
        align-items: center;
        gap: 8px;
      }
      .nav {
        display: flex;
        gap: 12px;
        justify-content: center;
        margin-top: 20px;
      }
      .kbd {
        border: 1px solid var(--border-light);
        background: var(--bg-secondary);
        padding: 0.2rem 0.6rem;
        border-radius: 8px;
        font-size: 12px;
        font-weight: 600;
        box-shadow: 0 2px 0 0 var(--border-light);
      }
      .row {
        display: flex;
        gap: 12px;
        align-items: center;
        justify-content: center;
        flex-wrap: wrap;
      }
      dialog {
        border: none;
        padding: 0;
        border-radius: 20px;
        width: min(700px, 96vw);
        background: var(--bg-card);
        color: var(--text-primary);
        box-shadow: var(--shadow-lg);
      }
      dialog::backdrop {
        background: rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(4px);
      }
      .modal-head {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 18px 24px;
        border-bottom: 1px solid var(--border-light);
        font-weight: 600;
        font-size: 18px;
      }
      .modal-body {
        padding: 20px 24px;
      }
      textarea {
        width: 100%;
        min-height: 200px;
        background: var(--bg-secondary);
        color: var(--text-primary);
        border: 1px solid var(--border-light);
        border-radius: 12px;
        padding: 14px;
        font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
        resize: vertical;
        margin: 12px 0;
        transition: var(--transition);
      }
      textarea:focus {
        outline: none;
        border-color: var(--accent-primary);
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
      }
      .hint {
        font-size: 13px;
        color: var(--text-secondary);
        background: var(--bg-secondary);
        padding: 12px;
        border-radius: 8px;
        margin: 12px 0;
      }
      .pill {
        background: var(--bg-secondary);
        border: 1px solid var(--border-light);
        padding: 6px 12px;
        border-radius: 999px;
        font-size: 13px;
        display: flex;
        align-items: center;
        gap: 6px;
      }
      .voice {
        margin-inline-start: 10px;
      }
      @media (max-width: 768px) {
        header {
          flex-direction: column;
          align-items: stretch;
          text-align: center;
        }
        .title {
          justify-content: center;
        }
        .controls {
          justify-content: center;
        }
        .stats {
          flex-direction: column;
          align-items: stretch;
        }
        .progress {
          width: 100%;
        }
      }
    </style>
  </head>
  <body>
    <div class="app">
      <header>
        <div class="title">Ø¨Ø·Ø§Ù‚Ø§Øª ÙƒÙ„Ù…Ø§Øª Ø£Ù„Ù…Ø§Ù†ÙŠØ© (Deutschâ†’Arabisch)</div>
        <div class="controls">
          <button id="btnShuffle" class="accent2">ğŸ”€ Ø®ÙÙ„Ù‘Ø·</button>
          <button id="btnImport">ğŸ“¥ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù…Ø¬Ù…ÙˆØ¹Ø©</button>
          <button id="btnReset" class="danger">â™»ï¸ ØªØµÙÙŠØ± Ø§Ù„ØªÙ‚Ø¯Ù‘Ù…</button>
        </div>
      </header>

      <div class="wrap">
        <div class="stats">
          <span class="pill">âœ… Ø§Ù„Ù…Ø¹Ø±ÙÙØ©: <b id="knownCnt">0</b></span>
          <span class="pill">â“ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ: <b id="unknownCnt">0</b></span>
          <span class="pill"
            >ğŸ“Š Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©: <b id="idx">1</b>/<b id="total">1</b></span
          >
          <div class="progress" aria-label="progress"><i id="bar"></i></div>
          <span class="hint"
            >Ø§Ø®ØªØµØ§Ø±Ø§Øª: <span class="kbd">Space</span> Ø§Ù‚Ù„Ø¨ØŒ
            <span class="kbd">â†/â†’</span> Ø§Ù„ØªØ§Ù„ÙŠ/Ø§Ù„Ø³Ø§Ø¨Ù‚ØŒ
            <span class="kbd">K</span> Ø£Ø¹Ø±ÙØŒ <span class="kbd">U</span> Ù…Ø§ Ø¨Ø¹Ø±ÙØŒ
            <span class="kbd">S</span> Ø®ÙÙ„Ù‘Ø·ØŒ
            <span class="kbd">P</span> Ù†Ø·Ù‚</span
          >
        </div>

        <div class="scene">
          <div id="card" class="card" role="button" aria-label="flip card">
            <div class="face front">
              <div>
                <div class="word" id="frontWord">â€”</div>
                <div class="sub">
                  Ø§Ø¶ØºØ· Ù„Ù‚Ù„Ø¨ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©
                  <span class="voice"
                    ><button id="speakFront" class="btn">ğŸ”Š Ù†Ø·Ù‚</button></span
                  >
                </div>
              </div>
            </div>
            <div class="face back">
              <div>
                <div class="word" id="backWord">â€”</div>
                <div class="sub">
                  Ø§Ø¶ØºØ· Ù„Ù„Ù‚Ù„Ø¨ Ù…Ø¬Ø¯Ø¯Ù‹Ø§
                  <span class="voice"
                    ><button id="speakBack" class="btn">ğŸ”Š Ù†Ø·Ù‚</button></span
                  >
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="nav row">
          <button id="prev" class="accent2">âŸµ Ø§Ù„Ø³Ø§Ø¨Ù‚</button>
          <button id="flip" class="accent">â†º Ø§Ù‚Ù„Ø¨</button>
          <button id="next" class="accent2">Ø§Ù„ØªØ§Ù„ÙŠ âŸ¶</button>
        </div>

        <div class="row">
          <button id="know" class="success">âœ… Ø£Ø¹Ø±Ù (K)</button>
          <button id="dontKnow" class="warning">â“ Ù…Ø§ Ø¨Ø¹Ø±Ù (U)</button>
        </div>
      </div>

      <dialog id="dlg">
        <div class="modal-head">
          <div>ğŸ“¥ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù…Ø¬Ù…ÙˆØ¹Ø© ÙƒÙ„Ù…Ø§Øª</div>
          <form method="dialog"><button>âœ–</button></form>
        </div>
        <div class="modal-body">
          <p class="hint">
            Ø§Ù„ØµÙŠØºØ© Ø§Ù„Ø³Ø±ÙŠØ¹Ø© (Ø³Ø·Ø± Ù„ÙƒÙ„ Ø¨Ø·Ø§Ù‚Ø©): <code>Wort â€“ ØªØ±Ø¬Ù…Ø©</code> Ø£Ùˆ
            <code>Wort, ØªØ±Ø¬Ù…Ø©</code>. Ù…Ø«Ø§Ù„:
          </p>
          <pre class="hint">
billig â€“ Ø±Ø®ÙŠØµ
Gefahr â€“ Ø®Ø·Ø±
entwickeln â€“ ÙŠØ·ÙˆÙ‘Ø±</pre
          >
          <textarea id="bulk" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ù‡Ù†Ø§..."></textarea>
          <div
            class="row"
            style="justify-content: space-between; margin-top: 10px"
          >
            <button id="loadSample">ØªØ­Ù…ÙŠÙ„ Ø¹ÙŠÙ‘Ù†Ø© Ø¬Ø§Ù‡Ø²Ø©</button>
            <div>
              <button formmethod="dialog">Ø¥Ù„ØºØ§Ø¡</button>
              <button id="apply" class="accent">Ø§Ø³ØªÙŠØ±Ø§Ø¯</button>
            </div>
          </div>
        </div>
      </dialog>
    </div>

    <script>
      // --- Sample inline deck (Deutsch â†’ Arabisch)
      const DEFAULT_DECK = [
        { front: "tragen", back: "Ù„ÙØ¨ÙØ³Ù" },
        { front: "mÃ¤dchenhaft", back: "Ø¨ÙÙ†ÙØ§ØªÙŠØ› ÙƒØ§Ù„ÙØªÙŠØ§Øª" },
        { front: "die Spezifikationen des Wagens", back: "Ù…ÙˆØ§ØµÙØ§Øª Ø§Ù„Ø³ÙŠØ§Ø±Ø©" },
        { front: "billig", back: "Ø±ÙØ®ÙÙŠØµÙŒ" },
        { front: "die Ausstattung", back: "ØªÙØ¬Ù’Ù‡ÙÙŠØ²Ø§ØªØ› Ù…Ø¹Ø¯Ø§Øª" },
        { front: "glÃ¼cklich", back: "Ø³ÙØ¹ÙÙŠØ¯ÙŒØ› Ù…Ø¨ØªÙ‡Ø¬" },
        { front: "der Fahrkomfort", back: "Ø§Ù„Ø±Ø§Ø­Ø© Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ù‚ÙŠØ§Ø¯Ø©" },
        { front: "Ã¼berleben", back: "Ù†ÙØ¬ÙØ§Ø› Ø§Ù„Ø¨Ù‚Ø§Ø¡ Ø¹Ù„Ù‰ Ù‚ÙŠØ¯ Ø§Ù„Ø­ÙŠØ§Ø©" },
        { front: "ausprobieren", back: "Ø¬ÙØ±Ù‘ÙØ¨Ù (Ù„Ø£ÙˆÙ„ Ù…Ø±Ø©)" },
        { front: "gÃ¼nstig", back: "Ø¨ÙØ®Ù’Ø³Ø› Ø±Ø®ÙŠØµØ› Ù…Ù†Ø§Ø³Ø¨" },
        { front: "es gab", back: "ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ" },
        { front: "das Angebot", back: "Ø¹ÙØ±Ù’Ø¶ (Ø§Ù‚ØªØµØ§Ø¯)" },
        { front: "die Regulierung", back: "ØªÙÙ†Ù’Ø¸ÙÙŠÙ…ÙŒ" },
        { front: "die Ã–ffnungszeiten", back: "Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ø¹Ù…Ù„" },
        { front: "freuen", back: "ÙÙØ±ÙØ­Ù" },
        { front: "sich freuen", back: "Ø§Ù†Ø´Ø±Ø­ ØµØ¯Ø±Ù‡Ø› ÙŠÙØ±Ø­" },
        { front: "treffen", back: "ØµÙØ§Ø¯ÙÙØ› ÙŠÙ„ØªÙ‚ÙŠ" },
        { front: "erwachsen", back: "Ø¨Ø§Ù„ÙØºÙŒ" },
        { front: "fÃ¶rdern", back: "Ø¯ÙØ¹Ù‘ÙÙ…ÙØ› ÙŠØ¹Ø²Ù‘Ø²" },
        { front: "die Aussprache", back: "Ù†ÙØ·Ù’Ù‚ÙŒ" },
        { front: "das SprachgefÃ¼hl", back: "Ø§Ù„Ø¥Ø­Ø³Ø§Ø³ Ø§Ù„Ù„ØºÙˆÙŠ" },
        { front: "leichter", back: "Ø£ÙÙŠÙ’Ø³ÙØ±ÙØ› Ø£Ø³Ù‡Ù„" },
        { front: "begreifen", back: "Ø§Ø³Ù’ØªÙÙˆÙ’Ø¹ÙØ¨Ø› ÙŠØ¯Ø±Ùƒ" },

        { front: "die Gefahr", back: "Ø®ÙØ·ÙØ±ÙŒ" },
        { front: "entwickeln", back: "ØªÙØ·ÙÙˆÙ‘ÙØ±ÙØ› Ù†Ù…Ù‘Ù‰" },
        { front: "die Eigenschaften", back: "Ù…ÙØ­Ø§Ø³ÙÙ†ÙØ› Ø®ØµØ§Ø¦Øµ" },
        { front: "festlegen", back: "ÙˆÙØ¶ÙØ¹ÙØ› Ø­Ø¯Ù‘Ø¯" },
        { front: "sich festlegen", back: "Ø­Ø¯Ù‘Ø¯ Ù„Ù†ÙØ³Ù‡" },
        { front: "diagnostizieren", back: "Ø´Ø®Ù‘Øµ Ø§Ù„Ù…Ø±Ø¶ (Ø·Ø¨)" },
        { front: "die Ruhe", back: "Ù‡ÙØ¯ÙÙˆØ¡ÙŒ" },
        { front: "empfohlen", back: "ÙŠÙÙ†ØµØ­ Ø¨Ù‡" },
        { front: "dringend", back: "Ø·ÙØ§Ø±ÙØ¦ÙŒ" },
        { front: "reden", back: "ØªÙØ­ÙØ¯Ù‘ÙØ«Ù" },
        { front: "genieÃŸen", back: "Ø§ÙØ³Ù’ØªÙÙ…Ù’ØªÙØ¹" },
        {
          front: "die Musik ist die Nahrung der Seele",
          back: "Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰ ØºØ°Ø§Ø¡ Ø§Ù„Ø±ÙˆØ­",
        },
        { front: "die Nahrung", back: "Ø§Ù„Ù’ØºØ°ÙØ§Ø¡" },
        { front: "die Seele", back: "Ø±ÙÙˆÙ’Ø­ÙŒ" },
        { front: "fÃ¼hlen", back: "Ø´ÙØ¹ÙØ±Ù" },
        { front: "erfreuen", back: "Ø£ÙØ±Ø­" },
        { front: "das LÃ¤cheln", back: "Ø§ÙØ¨Ù’ØªÙØ³ÙØ§Ù…ÙØ©ÙŒ" },
        { front: "erfÃ¼llt", back: "Ù…ÙÙ…Ù’ØªÙÙ„ÙØ¦ÙŒ" },
        { front: "erfÃ¼llen", back: "Ø§Ù…ØªÙ„Ø£" },
        { front: "die Freude", back: "Ø³ÙØ¹ÙØ§Ø¯ÙØ©ÙŒ" },
        { front: "prÃ¤feriert", back: "Ù…ÙÙÙØ¶Ù‘ÙÙ„" },
        { front: "vorfinden", back: "ÙˆÙØ¬ÙØ¯Ù" },
        { front: "entdecken", back: "Ø§ÙÙƒÙ’ØªÙØ´ÙÙÙ" },
        { front: "steigern", back: "Ø²Ø§Ø¯" },
        { front: "sich steigern", back: "Ø§ÙØ²Ù’Ø¯ÙØ§Ø¯Ù" },
        { front: "verplempern", back: "Ø£Ù‡Ù’Ø¯ÙØ±Ù" },
        { front: "sehr praktisch", back: "Ù…ÙÙŠØ¯ Ø¬Ø¯Ø§Ù‹" },
        { front: "lohnend", back: "Ù…ÙÙÙÙŠØ¯Ø› Ù†Ø§ÙØ¹" },
        { front: "zutrÃ¤glich", back: "Ù…ÙÙÙÙŠØ¯ÙŒ" },
        { front: "aneignen", back: "Ø§ÙÙƒÙ’ØªÙØ³ÙØ¨Ù" },
        { front: "die Kenntnis", back: "Ù…ÙØ¹Ø±ÙÙØ©" },
        { front: "die OpportunitÃ¤t", back: "ÙÙØ±Ù’ØµØ©" },
        { front: "die MÃ¶glichkeit", back: "ÙÙØ±Ù’ØµØ©" },
        { front: "das Ding", back: "Ø´ÙÙŠÙ’Ø¡ÙŒ" },
        { front: "das Zeug", back: "Ø´ÙÙŠÙ’Ø¡ÙŒ" },
        { front: "etwas", back: "Ø´ÙÙŠÙ’Ø¡ÙŒ" },
        { front: "die Lernenden", back: "Ù…ÙØªÙØ¹ÙÙ„Ù‘ÙÙ…ÙŠÙ†" },
        { front: "erwerben", back: "Ø§ÙÙƒÙ’ØªÙØ³ÙØ¨Ù" },
        { front: "Arbeit ist eine positive Sache", back: "Ø§Ù„Ø¹Ù…Ù„ Ø´ÙŠØ¡ Ø¥ÙŠØ¬Ø§Ø¨ÙŠ" },
        { front: "das Gehalt", back: "Ø±ÙØ§ØªÙØ¨ÙŒ" },
        { front: "verlÃ¤sslich", back: "Ù…ÙˆØ«ÙˆÙ‚ Ø¨Ù‡" },
        { front: "ausgefeilt", back: "Ù…ÙØªÙØ·ÙÙˆÙ‘ÙØ±ÙŒ" },
        { front: "ausgeklÃ¼gelt", back: "Ù…ÙØªÙØ·ÙÙˆÙ‘ÙØ±ÙŒ" },
        { front: "benutzen", back: "Ø§ÙØ³Ù’ØªÙØ®Ù’Ø¯ÙÙ…Ù" },
        { front: "verwenden", back: "Ø§ÙØ³Ù’ØªÙØ®Ù’Ø¯ÙÙ…Ù" },
        { front: "vergleichen", back: "Ù‚ÙØ§Ø±ÙÙ†Ù" },
        { front: "die Lieferung", back: "Ø·ÙÙ„ÙØ¨ÙŠÙ‘ÙØ©" },
      ];

      // --- Utilities ---
      const $ = (s) => document.querySelector(s);
      const speak = (text) => {
        try {
          const u = new SpeechSynthesisUtterance(text);
          u.lang = "de-DE";
          window.speechSynthesis.cancel();
          window.speechSynthesis.speak(u);
        } catch (e) {
          console.warn("TTS not available", e);
        }
      };
      const store = {
        save(key, val) {
          localStorage.setItem(key, JSON.stringify(val));
        },
        get(key, fallback) {
          try {
            return JSON.parse(localStorage.getItem(key)) ?? fallback;
          } catch {
            return fallback;
          }
        },
      };

      // --- State ---
      let deck = [];
      let idx = 0; // current index
      let known = new Set(store.get("known", []));
      let unknown = new Set(store.get("unknown", []));

      function updateCounters() {
        $("#knownCnt").textContent = known.size;
        $("#unknownCnt").textContent = unknown.size;
        $("#idx").textContent = Math.min(deck.length, idx + 1);
        $("#total").textContent = deck.length;
        const progress = deck.length ? ((idx + 1) / deck.length) * 100 : 0;
        $("#bar").style.width = progress + "%";
      }

      function showCard() {
        if (!deck.length) {
          $("#frontWord").textContent = "â€”";
          $("#backWord").textContent = "â€”";
          updateCounters();
          return;
        }
        const { front, back } = deck[idx];
        $("#frontWord").textContent = front;
        $("#backWord").textContent = back;
        $("#card").classList.remove("flipped");
        updateCounters();
      }

      function next() {
        if (!deck.length) return;
        idx = (idx + 1) % deck.length;
        showCard();
      }
      function prev() {
        if (!deck.length) return;
        idx = (idx - 1 + deck.length) % deck.length;
        showCard();
      }
      function flip() {
        $("#card").classList.toggle("flipped");
      }

      function shuffle() {
        for (let i = deck.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [deck[i], deck[j]] = [deck[j], deck[i]];
        }
        idx = 0;
        showCard();
      }

      function mark(set, other, key) {
        set.add(key);
        other.delete(key);
        store.save("known", Array.from(known));
        store.save("unknown", Array.from(unknown));
        updateCounters();
      }

      // --- Events ---
      $("#card").addEventListener("click", flip);
      $("#flip").addEventListener("click", flip);
      $("#next").addEventListener("click", next);
      $("#prev").addEventListener("click", prev);
      $("#btnShuffle").addEventListener("click", shuffle);
      $("#btnReset").addEventListener("click", () => {
        if (
          confirm(
            "Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù†Ùƒ ØªØ±ÙŠØ¯ ØªØµÙÙŠØ± Ø§Ù„ØªÙ‚Ø¯Ù…ØŸ Ø³ÙŠØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª."
          )
        ) {
          known = new Set();
          unknown = new Set();
          store.save("known", []);
          store.save("unknown", []);
          updateCounters();
        }
      });

      $("#know").addEventListener("click", () => {
        if (deck.length) {
          mark(known, unknown, deck[idx].front);
          next();
        }
      });
      $("#dontKnow").addEventListener("click", () => {
        if (deck.length) {
          mark(unknown, known, deck[idx].front);
          next();
        }
      });

      $("#speakFront").addEventListener("click", (e) => {
        e.stopPropagation();
        speak($("#frontWord").textContent);
      });
      $("#speakBack").addEventListener("click", (e) => {
        e.stopPropagation();
        speak($("#backWord").textContent);
      });

      document.addEventListener("keydown", (e) => {
        if ((e.key === " " || e.code === "Space") && !$("#dlg").open) {
          e.preventDefault();
          flip();
        } else if (e.key === "ArrowRight") {
          next();
        } else if (e.key === "ArrowLeft") {
          prev();
        } else if (e.key.toLowerCase() === "s") {
          shuffle();
        } else if (e.key.toLowerCase() === "k") {
          if (deck.length) {
            mark(known, unknown, deck[idx].front);
            next();
          }
        } else if (e.key.toLowerCase() === "u") {
          if (deck.length) {
            mark(unknown, known, deck[idx].front);
            next();
          }
        } else if (e.key.toLowerCase() === "p") {
          speak(
            $("#card").classList.contains("flipped")
              ? $("#backWord").textContent
              : $("#frontWord").textContent
          );
        }
      });

      // --- Import modal ---
      const dlg = $("#dlg");
      $("#btnImport").addEventListener("click", () => {
        $("#bulk").value = "";
        dlg.showModal();
      });

      $("#apply").addEventListener("click", () => {
        const text = $("#bulk").value.trim();
        if (!text) {
          alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø¨Ø¹Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø£ÙˆÙ„Ø§Ù‹");
          return;
        }
        const lines = text
          .split(/\n+/)
          .map((l) => l.trim())
          .filter(Boolean);
        const arr = [];
        for (const line of lines) {
          // split by en dash / hyphen / comma variants
          const parts = line.split(/\s*[â€“â€”-]|,\s*/);
          const front = (parts.shift() || "").trim();
          const back = parts.join(" ").trim();
          if (front && back) {
            arr.push({ front, back });
          }
        }
        if (arr.length) {
          deck = arr;
          idx = 0;
          showCard();
          dlg.close();
        } else {
          alert("Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø£ÙŠ Ø¨Ø·Ø§Ù‚Ø§Øª ØµØ§Ù„Ø­Ø©. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªÙ†Ø³ÙŠÙ‚.");
        }
      });

      $("#loadSample").addEventListener("click", () => {
        // Load the inline DEFAULT_DECK into the textarea
        $("#bulk").value = DEFAULT_DECK.map(
          (x) => `${x.front} â€“ ${x.back}`
        ).join("\n");
      });

      // --- Init ---
      (function init() {
        deck = DEFAULT_DECK.slice(); // use inline sample deck
        showCard();
      })();
    </script>
  </body>
</html>
