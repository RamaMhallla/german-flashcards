<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>اختبار أدوات الاستفهام (W-Fragen)</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --primary: #0ea5e9;
        --primary-light: #38bdf8;
        --success: #10b981;
        --danger: #ef4444;
        --border: #e5e7eb;
        --text: #1f2937;
        --text-light: #6b7280;
        --card: #fff;
        --bg1: #f3f4f6;
        --sidebar-w: 280px;
      }
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
      body {
        font-family: "Tajawal", sans-serif;
        background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
      }
      .topbar {
        display: none;
        position: sticky;
        top: 0;
        z-index: 30;
        background: #fff;
        border-bottom: 1px solid var(--border);
        padding: 10px 14px;
      }
      .hamburger {
        all: unset;
        cursor: pointer;
        padding: 8px 10px;
        border: 1px solid var(--border);
        border-radius: 10px;
      }
      .layout {
        display: grid;
        grid-template-columns: var(--sidebar-w) 1fr;
        min-height: 100vh;
      }
      #sidebar {
        background: #fff;
        border-inline-end: 1px solid var(--border);
        position: sticky;
        top: 0;
        height: 100vh;
        overflow: auto;
        box-shadow: 0 4px 18px rgba(0, 0, 0, 0.05);
      }
      #sidebar.as-overlay {
        position: fixed;
        inset-inline-start: 0;
        top: 52px;
        bottom: 0;
        width: 80vw;
        max-width: 320px;
        transform: translateX(110%);
        transition: 0.2s;
        border-inline-end: 1px solid var(--border);
        z-index: 40;
      }
      #sidebar.as-overlay.open {
        transform: translateX(0);
      }
      main.content {
        padding: 24px;
      }
      .app {
        width: min(980px, 100%);
        margin: auto;
      }
      .header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 16px;
        margin-bottom: 18px;
        flex-wrap: wrap;
      }
      h1 {
        color: var(--primary);
        font-size: clamp(24px, 3.4vw, 36px);
      }
      .subtitle {
        color: var(--text-light);
      }
      .pill {
        background: #f1f5f9;
        border: 1px solid var(--border);
        border-radius: 999px;
        padding: 6px 12px;
        color: var(--primary);
        font-weight: 700;
      }
      .card {
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: 18px;
        padding: 22px;
      }
      .progress {
        height: 10px;
        background: #f3f4f6;
        border-radius: 999px;
        overflow: hidden;
        margin: 12px 0 16px;
      }
      .progress > span {
        display: block;
        height: 100%;
        width: 0;
        background: linear-gradient(
          90deg,
          var(--primary-light),
          var(--primary)
        );
        transition: 0.35s;
      }
      .q-meta {
        display: flex;
        align-items: center;
        justify-content: space-between;
        color: var(--text-light);
        margin-bottom: 10px;
      }
      .q-index {
        padding: 6px 10px;
        border-radius: 999px;
        background: #f1f5f9;
        color: var(--primary);
        font-weight: 700;
      }
      .q-type {
        font-size: 12px;
        color: var(--primary);
        background: #ecfeff;
        border: 1px solid #bae6fd;
        padding: 4px 10px;
        border-radius: 999px;
      }
      .prompt {
        font-size: clamp(18px, 2.6vw, 24px);
        margin: 8px 0 14px;
      }
      .de {
        direction: ltr;
        unicode-bidi: plaintext;
        background: #f8fafc;
        border: 1px solid var(--border);
        border-radius: 8px;
        padding: 3px 8px;
        font-family: monospace;
      }
      .choices {
        display: grid;
        gap: 10px;
      }
      .choice {
        padding: 14px;
        border-radius: 12px;
        background: #f8fafc;
        border: 2px solid var(--border);
        cursor: pointer;
      }
      .choice:hover {
        background: #eef6ff;
        border-color: #c7e2ff;
      }
      .choice.selected {
        background: #e0f2fe;
        border-color: #7dd3fc;
      }
      .choice.correct {
        border-color: var(--success);
        background: rgba(16, 185, 129, 0.1);
      }
      .choice.wrong {
        border-color: var(--danger);
        background: rgba(239, 68, 68, 0.08);
      }
      .gap-line {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        justify-content: center;
      }
      select.gap {
        padding: 8px 12px;
        border: 2px solid var(--border);
        border-radius: 10px;
        min-width: 110px;
      }
      .type-wrap {
        display: flex;
        gap: 10px;
        justify-content: center;
      }
      .type-input {
        padding: 12px 14px;
        border: 2px solid var(--border);
        border-radius: 12px;
        min-width: 320px;
        direction: ltr;
      }
      .type-input.ok {
        border-color: var(--success);
        background: rgba(16, 185, 129, 0.08);
      }
      .type-input.bad {
        border-color: var(--danger);
        background: rgba(239, 68, 68, 0.08);
      }
      .actions {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        margin-top: 12px;
      }
      button {
        all: unset;
        padding: 12px 16px;
        border-radius: 12px;
        cursor: pointer;
        font-weight: 700;
      }
      .primary {
        background: linear-gradient(
          90deg,
          var(--primary),
          var(--primary-light)
        );
        color: #fff;
      }
      .ghost {
        border: 2px solid var(--border);
      }
      .feedback {
        margin-top: 12px;
        padding: 12px;
        border-radius: 12px;
        border: 1px solid;
      }
      .ok {
        background: rgba(16, 185, 129, 0.1);
        border-color: var(--success);
      }
      .bad {
        background: rgba(239, 68, 68, 0.1);
        border-color: var(--danger);
      }
      .tip {
        background: #fff7ed;
        border-color: #fed7aa;
      }
      @media (max-width: 900px) {
        .topbar {
          display: flex;
          justify-content: space-between;
        }
        .layout {
          grid-template-columns: 1fr;
        }
        #sidebar {
          display: none;
        }
        #sidebar.as-overlay {
          display: block;
        }
      }
    </style>
  </head>
  <body>
    <!-- Topbar + layout -->
    <div class="topbar">
      <button class="hamburger" id="menuBtn">☰</button><strong>W-Fragen</strong>
    </div>
    <div class="layout">
      <div id="sidebar"></div>
      <main class="content">
        <div class="app">
          <div class="header">
            <div>
              <h1>اختبار أدوات الاستفهام (W-Fragen)</h1>
              <div class="subtitle">
                Wer · Was · Wann · Warum · Wo/Woher/Wohin · Wie · Wie
                viel/oft/lange · Welche
              </div>
            </div>
            <div class="pill" id="gScore">النتيجة: 0 / 0</div>
          </div>

          <div class="card" id="quiz">
            <div class="q-meta">
              <div class="q-index" id="qIndex">سؤال 1 / ?</div>
              <div class="q-type" id="qType"></div>
            </div>
            <div class="progress"><span id="bar"></span></div>
            <div class="prompt" id="prompt"></div>
            <div id="content"></div>
            <div class="actions">
              <button class="primary" id="checkBtn">تحقّق</button>
              <button class="ghost" id="nextBtn" disabled>التالي ⟵</button>
              <button class="ghost" id="restartBtn">إعادة</button>
            </div>
            <div id="feedback"></div>
          </div>

          <details class="card" style="margin-top: 14px">
            <summary
              style="cursor: pointer; color: var(--primary); font-weight: 700"
            >
              📒 تذكير سريع
            </summary>
            <ul
              style="
                margin-top: 8px;
                line-height: 1.9;
                color: var(--text-light);
              "
            >
              <li>
                <b>Wer?</b> عن شخص فاعل · <b>Wen?</b> عن شخص مفعول ·
                <b>Was?</b> عن شيء
              </li>
              <li>
                <b>Wo?</b> مكان ثابت · <b>Wohin?</b> إلى أين · <b>Woher?</b> من
                أين
              </li>
              <li>
                <b>Wie viel</b> كم؟ · <b>Wie oft</b> كل كم مرة؟ ·
                <b>Wie lange</b> كم المدة؟
              </li>
            </ul>
          </details>
        </div>
      </main>
    </div>

    <script>
      // ===== sidebar loader =====
      document.addEventListener("DOMContentLoaded", () => {
        const host = document.getElementById("sidebar");
        const btn = document.getElementById("menuBtn");
        function applyMode() {
          const isMobile = matchMedia("(max-width:900px)").matches;
          if (isMobile) {
            host.classList.add("as-overlay");
          } else {
            host.classList.remove("as-overlay", "open");
            host.style.display = "";
          }
        }
        fetch("sidebar.html")
          .then((r) => r.text())
          .then((html) => {
            host.innerHTML = html;
            host
              .querySelectorAll(".section-header")
              .forEach((h) =>
                h.addEventListener("click", () =>
                  h.closest(".section").toggleAttribute("aria-expanded")
                )
              );
            const current = location.pathname.split("/").pop() || "fragen.html";
            host.querySelectorAll(".slink").forEach((a) => {
              if (a.getAttribute("href") === current) a.classList.add("active");
            });
            applyMode();
          })
          .catch(() => {
            host.innerHTML =
              '<aside style="padding:16px">لم يتم تحميل <b>sidebar.html</b>.</aside>';
            applyMode();
          });
        if (btn)
          btn.addEventListener("click", () => {
            if (host.classList.contains("as-overlay"))
              host.classList.toggle("open");
          });
        window.addEventListener("resize", applyMode);
      });

      // ===== utils =====
      const eqArr = (a, b) =>
        Array.isArray(a) &&
        Array.isArray(b) &&
        a.length === b.length &&
        a.every((v, i) => v === b[i]);
      const norm = (t) =>
        String(t || "")
          .toLowerCase()
          .replace(/[؟?!.]+$/, "")
          .replace(/\s+/g, " ")
          .trim();

      // ===== questions =====
      const Q = [
        {
          type: "mc",
          cat: "اختيار",
          prompt: `اختر السؤال المناسب: <span class="de">Ich heiße Rami.</span>`,
          choices: ["Wer?", "Wie?", "Was?"],
          answer: 1,
          explain: "نسأل عن الاسم: <b>Wie heißen Sie?</b>",
        },
        {
          type: "mc",
          cat: "اختيار",
          prompt: `أي أداة صحيحة: <span class="de">___ kommen Sie?</span> <span class="de">(Damaskus)</span>`,
          choices: ["Wo", "Wohin", "Woher"],
          answer: 2,
          explain: "عن الأصل/من أين → <b>Woher</b>.",
        },
        {
          type: "mc",
          cat: "اختيار",
          prompt: `اختر: <span class="de">___ gehst du jetzt?</span>`,
          choices: ["Wo", "Wohin", "Woher"],
          answer: 1,
          explain: "حركة باتجاه → <b>Wohin</b>.",
        },
        {
          type: "gap",
          cat: "فراغات",
          prompt: `اختر الأداة:`,
          segments: ['<span class="de">', " lernst du Deutsch?</span>"],
          options: [["Warum", "Wann", "Wie oft"]],
          answer: [0],
          explain: "نسأل عن السبب: <b>Warum</b>.",
        },
        {
          type: "gap",
          cat: "فراغات",
          prompt: `اختر الأداة:`,
          segments: ['<span class="de">', " kostet das?</span>"],
          options: [["Wie viel", "Wie lange", "Welche"]],
          answer: [0],
          explain: "عن السعر/الكمية: <b>Wie viel</b>.",
        },
        // {type:"type",cat:"كتابة حرّة",prompt:`اكتب السؤال المناسب:<br><span class="de">Ich wohne in Berlin.</span>`,answersText:["wo wohnst du","wo wohnen sie","wo wohnst du?"],explain:"<span class="de"> Wo wohnst du / wohnen Sie?</span>"},
        // {type:"type",cat:"كتابة حرّة",prompt:`اكتب السؤال:<br><span class="de">Ich komme aus Syrien.</span>`,answersText:["woher kommst du","woher kommen sie"],explain:"<span class="de">Woher kommst du?</span>"},
        // {type:"type",cat:"كتابة حرّة",prompt:`اكتب السؤال:<br><span class="de">Ich gehe nach Hause.</span>`,answersText:["wohin gehst du","wohin gehen sie"],explain:"<span class="de">Wohin gehst du?</span>"},
        {
          type: "multi",
          cat: "عدّد الصحيح",
          prompt: `اختر كل ما يُسأل به عن <b>الوقت/المدة/التكرار</b>`,
          choices: ["Wann", "Wie lange", "Wie oft", "Warum"],
          answers: [0, 1, 2],
          explain: "Wann/Wie lange/Wie oft.",
        },
        {
          type: "mc",
          cat: "Welche",
          prompt: `اختر: <span class="de">___ Stadt ist das?</span>`,
          choices: ["Welche", "Wie", "Was"],
          answer: 0,
          explain: "<b>Welche</b> مع أسماء محددة/اختيار.",
        },
      ];

      // ===== state & UI =====
      let i = 0,
        score = 0;
      const bar = document.getElementById("bar");
      const qIndex = document.getElementById("qIndex");
      const qType = document.getElementById("qType");
      const promptEl = document.getElementById("prompt");
      const content = document.getElementById("content");
      const fb = document.getElementById("feedback");
      const check = document.getElementById("checkBtn");
      const next = document.getElementById("nextBtn");
      const restart = document.getElementById("restartBtn");
      const gScore = document.getElementById("gScore");

      function render() {
        const q = Q[i];
        fb.innerHTML = "";
        next.disabled = true;
        check.disabled = false;
        qIndex.textContent = `سؤال ${i + 1} / ${Q.length}`;
        qType.textContent =
          q.type === "mc"
            ? "اختيار"
            : q.type === "multi"
            ? "متعدد"
            : q.type === "gap"
            ? "فراغات"
            : "كتابة حرّة";
        promptEl.innerHTML = q.prompt;
        content.innerHTML = "";
        bar.style.width = `${(i / Q.length) * 100}%`;
        gScore.textContent = `النتيجة: ${score} / ${i}`;
        if (q.type === "mc" || q.type === "multi") {
          const wrap = document.createElement("div");
          wrap.className = "choices";
          q.choices.forEach((c, ix) => {
            const b = document.createElement("button");
            b.className = "choice";
            b.innerHTML = c;
            b.onclick = () => {
              if (q.type === "mc") {
                [...wrap.children].forEach((x) =>
                  x.classList.remove("selected")
                );
                b.classList.add("selected");
              } else {
                b.classList.toggle("selected");
              }
            };
            wrap.appendChild(b);
          });
          content.appendChild(wrap);
        }
        if (q.type === "gap") {
          const gl = document.createElement("div");
          gl.className = "gap-line";
          q.segments.forEach((seg, ix) => {
            gl.insertAdjacentHTML("beforeend", seg);
            if (ix < q.options.length) {
              const s = document.createElement("select");
              s.className = "gap";
              q.options[ix].forEach((opt) => {
                const o = document.createElement("option");
                o.value = opt;
                o.textContent = opt;
                s.appendChild(o);
              });
              gl.appendChild(s);
            }
          });
          content.appendChild(gl);
        }
        if (q.type === "type") {
          const box = document.createElement("div");
          box.className = "type-wrap";
          const inp = document.createElement("input");
          inp.type = "text";
          inp.className = "type-input";
          inp.placeholder = "اكتب السؤال...";
          box.appendChild(inp);
          content.appendChild(box);
        }
      }
      function getUA(q) {
        if (q.type === "mc") {
          const sel = content.querySelector(".choice.selected");
          return sel
            ? [...content.querySelectorAll(".choice")].indexOf(sel)
            : null;
        }
        if (q.type === "multi") {
          return [...content.querySelectorAll(".choice.selected")]
            .map((b) => [...content.querySelectorAll(".choice")].indexOf(b))
            .sort((a, b) => a - b);
        }
        if (q.type === "gap") {
          return [...content.querySelectorAll("select.gap")].map(
            (s) => s.value
          );
        }
        if (q.type === "type") {
          const t = content.querySelector(".type-input");
          return t ? t.value : "";
        }
      }
      check.onclick = () => {
        const q = Q[i];
        const ua = getUA(q);
        if (
          ua === null ||
          (Array.isArray(ua) && ua.length === 0) ||
          (q.type === "type" && String(ua).trim() === "")
        ) {
          fb.innerHTML = '<div class="feedback tip">أجب أولًا.</div>';
          return;
        }
        let ok = false;
        if (q.type === "mc") ok = ua === q.answer;
        if (q.type === "multi") ok = eqArr(ua, q.answers);
        if (q.type === "gap")
          ok = eqArr(
            ua,
            q.answer.map((a, ix) => q.options[ix][a])
          );
        if (q.type === "type")
          ok = (q.answersText || []).map(norm).includes(norm(ua));

        if (q.type === "mc" || q.type === "multi") {
          const btns = [...content.querySelectorAll(".choice")];
          if (q.type === "mc") {
            btns.forEach((b, ix) => {
              if (ix === q.answer) b.classList.add("correct");
              if (ix !== q.answer && b.classList.contains("selected"))
                b.classList.add("wrong");
            });
          } else {
            btns.forEach((b, ix) => {
              if ((q.answers || []).includes(ix)) b.classList.add("correct");
              if (
                !(q.answers || []).includes(ix) &&
                b.classList.contains("selected")
              )
                b.classList.add("wrong");
            });
          }
        }
        if (q.type === "gap") {
          [...content.querySelectorAll("select.gap")].forEach((s, ix) => {
            const right = q.options[ix][q.answer[ix]];
            s.style.borderColor =
              s.value === right ? "var(--success)" : "var(--danger)";
          });
        }
        if (q.type === "type") {
          const inp = content.querySelector(".type-input");
          if (inp) {
            inp.classList.toggle("ok", ok);
            inp.classList.toggle("bad", !ok);
          }
        }
        fb.innerHTML = `<div class="feedback ${ok ? "ok" : "bad"}">${
          ok ? "صحيح ✅" : "غير صحيح ❌"
        } ${q.explain || ""}</div>`;
        if (ok) score++;
        gScore.textContent = `النتيجة: ${score} / ${i + 1}`;
        bar.style.width = `${((i + 1) / Q.length) * 100}%`;
        next.disabled = false;
        check.disabled = true;
        if (i === Q.length - 1) next.textContent = "عرض النتيجة";
      };
      next.onclick = () => {
        if (i < Q.length - 1) {
          i++;
          render();
          next.disabled = true;
          check.disabled = false;
        } else {
          const p = Math.round((score / Q.length) * 100);
          document.getElementById(
            "quiz"
          ).innerHTML = `<div class="prompt" style="text-align:center">انتهى ✅</div>
          <div class="feedback ${
            p >= 80 ? "ok" : p >= 60 ? "tip" : "bad"
          }" style="text-align:center">نتيجتك: <b>${score}</b> / <b>${
            Q.length
          }</b> (${p}%)</div>
          <div class="actions" style="justify-content:center;margin-top:10px"><button class="primary" onclick="location.reload()">إعادة</button></div>`;
        }
      };
      restart.onclick = () => {
        i = 0;
        score = 0;
        render();
      };
      render();
    </script>
  </body>
</html>
